---
title:      比较 Swift 中的闭包和 Objective-C 中的 Block
date:       2024-04-06
tags:
- Swift
- 闭包
- block
--- 


在 iOS 开发中，闭包（Swift）和 Block（Objective-C）都是用于实现匿名函数的重要概念。它们在很多方面都有相似之处，但也存在一些显著的差异。本文将从应用和原理两个层面对 Swift 中的闭包和 Objective-C 中的 Block 进行比较和分析。

## 1. 应用层面的比较

### 1.1 相似之处

- **功能性相同：** 闭包和 Block 都允许将代码片段作为对象来传递和使用，从而实现函数式编程的概念。
- **作为参数传递：** 闭包和 Block 都可以作为函数或方法的参数，用于回调和异步操作。
- **捕获外部变量：** 闭包和 Block 都可以捕获并访问其所在上下文中的变量，使得在闭包或 Block 内部可以访问外部作用域的变量。

### 1.2 差异之处

- **语法差异：** 闭包的语法相对于 Block 更加简洁清晰，使用 `{}` 表示闭包的起始和结束，而 Block 的语法则更加繁琐，需要使用 `^` 符号标识，并在参数列表之前使用。
- **类型推断：** Swift 中的闭包具有类型推断的特性，可以根据上下文自动推断闭包的类型，而 Objective-C 中的 Block 需要手动指定返回值类型和参数列表。
- **内存管理：** 在 Objective-C 中，使用 Block 时需要注意循环引用的问题，并手动进行内存管理，比如使用 `__weak` 或 `__block` 关键字来避免循环引用。而在 Swift 中，由于自动引用计数（ARC）的存在，闭包会自动捕获和管理其引用的外部变量，大大减少了出现循环引用的可能性。
- **逃逸闭包：** Swift 中的闭包默认是非逃逸的，即闭包在函数执行完毕后就被释放，而 Objective-C 中的 Block 默认是逃逸的，可以在函数执行完毕后继续存在。在 Swift 中，如果需要定义逃逸闭包，需要使用 `@escaping` 关键字进行标记。

## 2. 原理层面的比较

### 2.1 相似之处

- **底层实现：** 闭包和 Block 在底层都是基于函数指针实现的，它们都是一种可执行的代码块。
- **捕获变量原理：** 闭包和 Block 都可以捕获其所在上下文中的变量，并存储对这些变量的引用。这是通过在闭包或 Block 内部创建一个包含外部变量的结构体来实现的。

### 2.2 差异之处

- **捕获变量方式：** 在 Swift 中，闭包捕获变量时是以值的方式进行的，即捕获的是变量的拷贝，而在 Objective-C 中，Block 默认捕获变量时是以指针的方式进行的，即捕获的是变量的引用。
- **内存管理机制：** 在 Swift 中，由于 ARC 的存在，闭包会自动管理其引用的外部变量的内存释放，而在 Objective-C 中，需要手动管理 Block 的内存，特别是在循环引用的情况下需要特别注意。
- **语言特性影响：** Swift 的闭包设计更加简洁和安全，受到函数式编程语言的影响，因此在使用闭包时更加方便和直观。而 Objective-C 的 Block 在语法和内存管理上相对较为复杂，需要开发者更加小心地处理。

## 3. 结语

在本文中，我们对 Swift 中的闭包和 Objective-C 中的 Block 进行了比较和分析，从应用和原理两个层面探讨了它们的相似之处和差异之处。虽然它们在功能上有很多共同点，但在语法、内存管理以及语言特性上存在一些显著的不同。理解和熟练使用闭包和 Block 是 iOS 开发中的重要技能，希望本文能够帮助读者更加深入地理解它们的原理和应用。